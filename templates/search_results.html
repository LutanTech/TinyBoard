<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Students</title>
</head>
<body>
    <h1>Search Students</h1>

    <form method="POST">
        {{ form.hidden_tag() }}
        <div>
            <label for="query">Search:</label>
            {{ form.query(class="form-control") }}
        </div>
        <div>
            <label for="filter_type">Filter By:</label>
            {{ form.filter_type(class="form-control") }}
        </div>
        <button type="submit" class="btn btn-primary">Search</button>
    </form>
<div id="resultsDiv"></div>
    {% if students.items %}
    <h2>Search Results for {{query}} ({{ total_count }} found):</h2>
    <ul>
        {% for student in students.items %}
        <li>
            <strong>{{ student.name }}</strong> ({{ student.grade }}) - 
            <a href="mailto:{{ student.email }}">{{ student.email }}</a> 
            - {{ student.adm }} - 
            Phone: {{ student.phone1 }}
        </li>
        {% endfor %}
    </ul>

    <div>
        {% if students.has_prev %}
            <a href="{{ url_for('search', page=students.prev_num) }}">Previous</a>
        {% endif %}
        
        <span>Page {{ students.page }} of {{ students.pages }}</span>
        
        {% if students.has_next %}
            <a href="{{ url_for('search', page=students.next_num) }}">Next</a>
        {% endif %}
    </div>
    {% else %}
    <p>No students found.</p>
    {% endif %}
<script>
    function searchStudents() {
  const query = document.getElementById('query').value;
  const filterType = document.getElementById('filter_type').value;

  fetch(`/search?query=${encodeURIComponent(query)}&filter_type=${encodeURIComponent(filterType)}`, {
    headers: { 'X-Requested-With': 'XMLHttpRequest' }
  })
    .then(response => response.json())
    .then(data => {
      const resultsDiv = document.getElementById('resultsDiv');
      resultsDiv.innerHTML = '';

      if (data.students.length === 0) {
        resultsDiv.innerHTML = '<p>No students found. 🕵️‍♂️</p>';
        return;
      }

      const ul = document.createElement('ul');
      data.students.forEach(student => {
        const li = document.createElement('li');
        li.innerHTML = `<strong>${student.name}</strong> (${student.grade}) - ${student.email}`;
        ul.appendChild(li);
      });
      resultsDiv.appendChild(ul);
    })
    .catch(error => {
      console.error('Oops, something went wrong! 🧯', error);
    });
}
document.getElementById('query').addEventListener('input', () => {
  searchStudents();
});

</script>
</body>
</html>
